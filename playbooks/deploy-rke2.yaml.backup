- name: Deploy RKE2 Cluster
  hosts:
    - rke2
  vars_files:
    - /home/{{ ansible_user }}/Ansible/inventory/group_vars/secrets.yaml
  become: false
  roles:
    # Install Helm on all nodes
    - role: wolskinet.rke2_ansible.helm_install
      become: false

    # Install RKE2 cluster on all nodes
    - role: wolskinet.rke2_ansible.deploy_rke2
      become: true

    # Install Rancher management platform (first controller only)
    - role: wolskinet.rke2_ansible.rancher_install
      when: inventory_hostname == (groups['controllers'] | first)
      become: false
      tags: rancher

    # Storage options - (first controller only)
    # Longhorn - distributed block storage
    - role: wolskinet.rke2_ansible.longhorn_install
      when: inventory_hostname == (groups['controllers'] | first)
      become: false
      tags: longhorn

    # Rook/Ceph - distributed storage alternative
    # - role: wolskinet.rke2_ansible.rook_install
    #   when: inventory_hostname == (groups['controllers'] | first)
    #   become: false
    #   tags: rook

    # MinIO - object storage
    # - role: wolskinet.rke2_ansible.minio_install
    #   when: inventory_hostname == (groups['controllers'] | first)
    #   become: false
    #   tags: minio

    # MySQL Operator - database operator
    # - role: wolskinet.rke2_ansible.mysql_operator
    #   when: inventory_hostname == (groups['controllers'] | first)
    #   become: false
    #   tags: mysql
