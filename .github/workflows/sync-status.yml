# Auto-add sync status to PRs and issues
---
name: "Repository Sync Status"

on: # yamllint disable-line rule:truthy
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  add-sync-notice:
    name: "Add Sync Notice"
    runs-on: ubuntu-latest
    steps:
      - name: Add sync notice to issues
        if: github.event_name == 'issues'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## 📢 Repository Sync Notice
              
              This is a **synced repository** from a self-hosted GitLab instance.
              
              **For contributions:**
              - 🔄 Changes made here will be synced back to GitLab
              - 🚀 Primary CI/CD runs on GitLab self-hosted runners
              - ✅ GitHub Actions provide validation and community compliance
              
              **CI Status:**
              - **GitLab CI**: Full test suite, security scans, deployment tests
              - **GitHub Actions**: Community validation, collection verification
              
              Thank you for your contribution! 🙏`
            });

      - name: Add sync notice to PRs
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## 🔄 Synced Repository PR
              
              **CI Pipeline Status:**
              - ✅ **GitHub Actions**: Community validation & basic tests
              - 🚀 **GitLab CI**: Full test suite (self-hosted)
              
              **What runs where:**
              - **GitHub**: Fast validation, community compliance, collection verification
              - **GitLab**: Complete test matrix, security scans, Molecule tests, deployment validation
              
              **Merge Process:**
              1. GitHub Actions must pass ✅
              2. PR will be synced to GitLab for full testing
              3. Manual merge after GitLab CI completion
              
              *This repository is automatically synced from GitLab self-hosted.*`
            });